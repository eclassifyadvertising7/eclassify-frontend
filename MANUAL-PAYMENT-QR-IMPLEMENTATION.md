# Manual Payment QR Code Implementation

## Overview
Complete implementation of QR code management for manual payment subscriptions.

---

## Features Implemented

### 1. API Service Updates (`src/app/services/api/manualPaymentService.js`)

**New Functions:**
- `uploadQRCode(formData)` - Admin uploads QR code with UPI ID
- `getQRCode()` - Public endpoint to fetch current QR code

**Endpoints:**
- `POST /api/panel/manual-payments/qr-code` - Upload/update QR code (Admin)
- `GET /api/public/manual-payments/qr-code` - Get QR code (Public)

---

### 2. Admin QR Upload Modal (`src/components/admin/QRCodeUploadModal.jsx`)

**Features:**
- File upload with preview
- UPI ID input (stored as caption)
- Validation: Max 2MB, JPG/PNG only
- Success/error handling with toast notifications

**Usage:**
```jsx
<QRCodeUploadModal
  isOpen={qrUploadModal}
  onClose={() => setQrUploadModal(false)}
  onSuccess={() => toast.success("QR code updated")}
/>
```

---

### 3. Admin Manual Payments Page Updates (`src/app/(root)/admin/manual-payments/page.jsx`)

**New Features:**
- "Upload QR" button in header
- Opens QR upload modal
- Integrated with existing payment management

**UI Location:**
- Top right corner next to "Filters" button
- Primary blue button with Upload icon

---

### 4. User Payment Modal Updates (`src/components/ManualPaymentModal.jsx`)

**Changes:**
- Fetches real QR code from API on modal open
- Displays QR code image from backend
- Shows UPI ID from caption field
- Loading state while fetching QR
- Error state if QR not configured
- Fallback message for missing QR code

**Flow:**
1. Modal opens → Fetches QR code
2. Displays QR image + UPI ID
3. User scans and pays
4. User submits payment details

---

## API Integration

### Upload QR Code (Admin)
```javascript
const formData = new FormData()
formData.append('qrCode', file)
formData.append('caption', upiId) // UPI ID stored as caption

await manualPaymentService.uploadQRCode(formData)
```

### Get QR Code (Public)
```javascript
const response = await manualPaymentService.getQRCode()
// response.data contains:
// - mediaUrl: Full URL to QR image
// - caption: UPI ID
// - mimeType, storageType, etc.
```

---

## Data Flow

### Admin Side:
1. Admin clicks "Upload QR" button
2. Modal opens with file input and UPI ID field
3. Admin selects QR image and enters UPI ID
4. Submits → `POST /api/panel/manual-payments/qr-code`
5. Backend stores image and UPI ID (as caption)
6. Success toast shown

### User Side:
1. User clicks "Choose Plan" on pricing page
2. Payment modal opens
3. Modal fetches QR code → `GET /api/public/manual-payments/qr-code`
4. Displays QR image and UPI ID
5. User scans, pays, and submits details
6. Subscription created with pending status

---

## File Structure

```
src/
├── app/
│   ├── services/api/
│   │   └── manualPaymentService.js (Updated)
│   └── (root)/
│       └── admin/
│           └── manual-payments/
│               └── page.jsx (Updated)
└── components/
    ├── admin/
    │   └── QRCodeUploadModal.jsx (New)
    └── ManualPaymentModal.jsx (Updated)
```

---

## Key Points

✅ **Uses httpClient** for all API calls (follows api-guidelines.md)
✅ **UPI ID stored as caption** in media table
✅ **Public endpoint** for QR code (no auth required)
✅ **Admin-only upload** (Super Admin access)
✅ **File validation** (2MB max, JPG/PNG only)
✅ **Loading states** and error handling
✅ **Toast notifications** for user feedback
✅ **Responsive design** with Tailwind CSS

---

## Testing Checklist

- [ ] Admin can upload QR code with UPI ID
- [ ] QR code preview shows in upload modal
- [ ] File validation works (size, type)
- [ ] User sees real QR code in payment modal
- [ ] UPI ID displays correctly
- [ ] Loading state shows while fetching
- [ ] Error state shows if QR not configured
- [ ] QR code updates replace old one
- [ ] Public endpoint accessible without auth

---

## Notes

- QR code is stored with `identifierSlug: 'manual-payment-qr'`
- Only one QR code exists at a time (updates replace old one)
- Caption field stores UPI ID for display
- Backend handles file storage (Cloudinary or local)
- Full URL automatically generated by backend
